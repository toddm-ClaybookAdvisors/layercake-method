
<!--
  FILE: chat-boot.md
  PURPOSE: Single-source authoritative workflow and compliance policy for LLM-driven software/game development. Establishes strict requirements for prompt, commit, artifact, devlog, and audit behavior—no human code, LLM must comply with all rules or halt and report.
  GENERATED BY: Layer 0035 (move chat, maximum clarity pass, minor ambiguity fix) + Layer 0033 (game summary/context additions)
  LLM MODEL: GPT-4o (2024-06)
-->

# PROJECT BOOTSTRAP — LLM-Driven Game Development

---

## MANDATORY INTERPRETATION AND ENFORCEMENT POLICY

This section is non-negotiable. If any ambiguity arises in this file, it MUST be interpreted in favor of the strictest, most auditable enforcement.

- Any rule, policy, or template in this file labeled “MUST” or “MUST NOT” is non-negotiable.
- Any ambiguity or conflict must be resolved in favor of the most restrictive, auditable interpretation.
- Any workflow, commit, devlog, or artifact deviation from chat-boot.md MUST be immediately reported both in the chat and in the relevant devlog file, as an “audit/compliance” note.

---

## MANDATORY: DEVLOG OUTPUT POLICY

This section is non-negotiable. If any ambiguity arises, enforce the strictest version of the following:

- For every committed layer, the AI MUST output a devlog file named `logs/devlog/devlog-XXXX.md`, where `XXXX` is the layer number (zero-padded to four digits).
- The devlog file MUST:
    - Contain the strict, complete, message-by-message conversation for the layer.
    - Label each message `Todd:` or `ai-agent:`.
    - Include **no summaries, no code, and no file outputs inside the devlog except for the single outer markdown code block**.
    - Be a single, continuous markdown code block transcript (no content outside the block, no block breaks, and no additional markdown blocks inside).
    - Contain only the conversation transcript—**no commentary, summaries, or extra formatting inside the code block**.
    - Code and file outputs, summaries, and other artifacts may only be included in their appropriate artifacts (not the devlog).

- Any deviation is a workflow error and MUST be immediately reported as above.

---

## Purpose

This project exists **not to build a game**, but as a transparent demonstration of how an LLM can act as a complete software development assistant for an end-to-end, prompt-driven workflow, with zero human-authored code.

- All architectural, functional, and implementation work is LLM-authored, with prompt-by-prompt traceability.
- All commits, devlogs, and artifacts MUST support auditability, clarity, and full historical trace.

---

## Definitions

This section is non-negotiable.  
- **Session:** A contiguous block of development activity, ending only with explicit user sign-off or a move chat.
- **Layer:** A single, atomic, prompt-driven increment of the codebase (see “Layer Types”).

---

## Game Summary Policy

- At the end of each layer, the AI MUST generate and append a concise “Game Summary” to the output.  
- The Game Summary MUST include:
    - The core gameplay loop
    - The player’s main actions/objectives
    - The types of game entities and map elements present
    - Any significant mechanics, features, or changes introduced in that layer
- The Game Summary is for context transfer only, not for inclusion in the devlog or commit artifacts.
- The Game Summary MUST be the final section of each layer’s output, clearly labeled as such.

---

## Game Summary

**Current Game:**  
A dungeon map is procedurally generated containing a player, an adversary, and a door. The player’s objective is to locate and reach the door. The adversary’s goal is to hunt the player. Both the player and adversary leave visible trails on the map; each can see the other’s trail. If the adversary discovers the player’s trail, it “locks on” and actively pursues the player in an attempt to catch them before the player reaches the door. The player wins by escaping through the door; the player loses if the adversary catches them.  
**The map features a Fog of War system, limiting what the player and adversary can see to their immediate surroundings.**  
**Player attributes:** The player now has health, speed, and vision radius, which are displayed in the HUD and may be modified by future power-ups, map elements, or events.

**Near-term Goal:**  
Add additional interesting elements commonly found in roguelike games.

---

## Game File Reference

The following files constitute the primary components of the game. Any future feature, mechanic, or logic change is likely to involve one or more of these files:

- **entities.py**  
  *Defines all game entities, including player and adversary behaviors, attributes, and actions.*

- **game.py**  
  *Coordinates the game loop, manages turn order, win/lose conditions, and global state. Handles all input via curses.*

- **renderer.py**  
  *Handles rendering of the dungeon map, entities, player/adversary trails, Fog of War, and all game symbols/colors, using Python curses for sticky HUD and real-time updates.*

- **mapgen.py**  
  *Responsible for procedural dungeon map generation, room placement, connectivity, and tile assignment.*

- **utils.py**  
  *Contains shared utility functions and helpers used by other modules.*

- **config.json**  
  *Stores global game configuration (map size, viewport, procedural generation parameters, etc.)*

---

## Rules & Policies

### **Absolute Prohibitions**

- **No user-authored code or manual file changes may ever be committed.**
  - The LLM is the only permitted code author; any human edit to source or artifact files MUST be detected and reported.
- **No LLM code or file refactoring outside an active `refactor` layer.**
  - The LLM MUST NOT change, restructure, or reformat code unless the current layer is type `refactor`.
- **No emoji or non-ASCII characters may appear in any code, logs, documentation, commit messages, or devlogs.**
- **No reference to excluded files or directories.**
  - Excluded files/directories MUST NOT be referenced, updated, generated, or included in any workflow, code, or artifact.

---

### **Context Management and Artifact Rules**

- **Context Upload Enforcement**
  - If a file is to be modified and is not already loaded in context, the AI MUST prompt the user to upload it before proceeding. Any skip is a workflow error.
- **Code Preview Integrity**
  - All code previews MUST be complete markdown code blocks (no partials, no splitting across messages, no inline code).
- **Template Policy**
  - Any required file template MUST be included at the bottom of chat-boot.md as a complete markdown code block.
  - Templates MUST NOT be given as lists, partials, or plain text.
  - Templates MUST be included at the absolute end of the file and must retain the order in which they appear in this policy.
- **Commit Message Clarity**
  - All commit messages MUST be detailed, explicit, and state what was changed and why. Bullet points and vague summaries are prohibited.
- **Policy Update Enforcement**
  - If the user requests or enforces a process change, the LLM MUST immediately update chat-boot.md to reflect the new rule, and the new policy MUST govern all future work.

---

### **Workflow State and Process Management**

- **Workflow State Visibility**
  - The current workflow state (e.g., `create layer`, `test`, `commit`, etc.) MUST be stated at the top of every assistant response except inside code blocks.
- **Workflow Step Completeness**
  - If any required step is skipped or omitted, the LLM MUST prompt the user before proceeding.
- **State Transition Explanation**
  - When changing workflow state, the LLM MUST explain the purpose of the state and the expected outputs, unless the user disables this.
- **Merge Workflow Enforcement**
  - At the end of each session, the LLM MUST ask if a merge to `main` will be performed. If yes, the LLM MUST:
      - Prompt for the latest `README.md` (and for upload if not loaded).
      - Update `README.md` to reflect the current project state.
      - Prompt for `git log --oneline` and use it to update `LAYER_INDEX.md` with current commit hashes.
      - Only update `LAYER_INDEX.md` during merges to `main`.
- **File Header Enforcement**
  - Every file generated or modified by the LLM MUST begin with a top-of-file comment that describes its purpose, originating layer, and LLM model used.

---

### **Manual Edit and Audit Policy**

- **Manual Edits**
  - On `complete`, for each modified file, the user MUST upload the current version (if not already loaded).
  - The LLM MUST diff the versions.  
    - If differences are found:
      - The LLM MUST label each differing section with a `// MANUAL EDIT REVIEW: ...` comment.
      - The LLM MUST summarize and report differences, and require user confirmation, rejection, or reconciliation before proceeding.
      - All decisions, notifications, and actions MUST be logged in the devlog.
  - Any manual change to code or artifacts detected at any point MUST be explicitly reported in chat and the devlog, with `audit/compliance` language.

---

### **LAYER_INDEX.md Update Policy**

- `LAYER_INDEX.md` MUST only be updated when merging to `main`.  
- During normal development on feature, fix, or refactor branches, `LAYER_INDEX.md` MUST NOT be updated.
- All updates MUST include current commit hashes and prompt links.

---

### **All rules in this section are mandatory. Any workflow, commit, or artifact deviation from chat-boot.md must be reported in both the chat and the relevant devlog file.**

---

## Iterative Refactor Workflow

This section is non-negotiable.

- All refactor work MUST follow this iterative process:
  1. Start with a clear overall goal.
  2. Break the goal into individual, manageable tasks (each should make later tasks easier).
  3. Implement and test each task, one at a time.
  4. For each, create a checkpoint commit to be amended until the full refactor is complete.
  5. Repeat until all tasks are complete.
  6. When done, run a single `git commit --amend` with a complete, unified message for the layer.

---

## Python Comment Style Policy

This section is non-negotiable.

- All Python code MUST use:
  - Multi-line `#` comments for file-level/project headers (not HTML or XML).
  - Triple-quoted docstrings (`""" ... """`) for all function, class, and module documentation.
  - **MUST NOT** use HTML-style (`<!-- ... -->`) comments or non-Python conventions in `.py` files.

---

## JSON `_comment` Uniqueness Policy

This section is non-negotiable.

- When using `_comment` fields for inline documentation in JSON, all `_comment` keys MUST be unique within their object.

---

## “Remember” Policy

This section is non-negotiable.

- Any instruction from the user that begins with “remember” MUST be added to `chat-boot.md` at the next move chat or policy update, including workflow, coding, or project-specific rules.

---

## Layer Types

This section is non-negotiable.

All work is organized into numbered **layers**, each with exactly one of the following types:

- `feature`: New capabilities or mechanics.
- `refactor`: Code or architecture restructuring (no behavioral change).
- `fix`: Regression or bug resolution.
- `move chat`: Starts a new thread, updates only `chat-boot.md`, carries all state forward, **does not increment layer number**.

---

## Layer Lifecycle

This section is non-negotiable.

Every layer MUST follow this sequence:

1. **`create layer`**  
   Specify type and intent.  
   - Layer number increments only for `feature`, `refactor`, or `fix`. `move chat` does not increment.
2. **Prompt**  
   User describes desired outcome.  
   - **Original prompt is stored only in the devlog, not `PROMPTS.md`.**
3. **`test`**  
   LLM generates all affected code in a single, complete markdown block.
4. **Iterate**  
   Discuss, preview, revise, and test implementation.  
   - All conversation is logged in the devlog.
5. **`complete`**  
   Confirm finalized implementation.
   - List all affected files; prompt for upload if not loaded.
   - Compare with LLM version and review all differences.
   - Manual edits must be explicitly reviewed and logged.
6. **`commit`**  
   - Generate artifacts:  
      - `PROMPTS.md` (interpreted instruction only)  
      - `devlog/devlog-XXXX.md` (full transcript)  
      - Git commit (must end with layer number)  
      - Update `chat-boot.md` if `move chat`
7. **Post-commit**  
   - Remind: do not push yet.
   - Prompt for `git log --oneline`.
   - Use for updating `LAYER_INDEX.md`.
   - Create a git amend command if needed (must not change commit message).
8. **`merge`**  
   - At session end, ask if merging to `main`.  
   - If yes: prompt for/upload `README.md`, update with current state, and use latest `git log --oneline` to update `LAYER_INDEX.md`.
   - **`LAYER_INDEX.md` is only updated during merge to `main`.**

---

## File Expectations

This section is non-negotiable.

- Any file to be modified that is not already in context MUST be requested for upload before modification.
- All code previews MUST be a single, complete markdown block.
- Devlogs MUST be full transcripts with no code or file outputs, as strictly described in the “MANDATORY: DEVLOG OUTPUT POLICY”.

---

## GitHub Integration

This section is non-negotiable.

- All commit links MUST use:  
  `https://github.com/toddm-ClaybookAdvisors/layercake-method/commit/<hash>`
- Prompt links use:  
  `logs/PROMPTS.md#prompt-XXXX`
- Devlogs are stored at:  
  `logs/devlog/devlog-XXXX.md`

---

## Git Commit Expectations

This section is non-negotiable.

- All commit messages MUST be detailed, explicit, and must not use summary bullet points.
- When outputting a `git commit` command, no commentary is allowed after the command.

---

## Move Chat Policy

This section is non-negotiable.

- **A “move chat” layer may only generate and update `chat-boot.md`.**
- **MUST NOT** update, generate, or touch `README.md` or `LAYER_INDEX.md` during a move chat.
- All new rules and policies MUST be carried forward in the new `chat-boot.md` only.
- All other files/logs are unchanged—update only in feature, fix, or refactor layers.

---

## Current Directory Layout

└── README.md  
├── app  
│   └── config.json  
│   ├── src  
│   │   └── entities.py  
│   │   └── game.py  
│   │   └── mapgen.py  
│   │   └── renderer.py  
│   │   └── utils.py  
├── bin  
│   └── get_project_structure.sh  
│   └── play_game.sh  
└── chat-boot.md  
├── docs  
│   └── AUTHOR_NOTES.md  
│   └── PROMPTS.md  
│   └── LAYER_INDEX.md  
│   └── PYTHON_SETUP.md  
├── logs  
│   └── PROMPTS.md  
│   ├── devlog  
│   │   └── devlog-0017  
│   │   └── devlog-0019  
│   │   └── devlog-0020  
│   │   └── devlog-0021  
│   │   └── devlog-0022  
│   │   └── devlog-0023  
│   │   └── devlog-0025  
│   │   └── devlog-0026  
└── start_dev_session.sh  

---

## Explicit Template Inclusion Policy

This section is non-negotiable.

- All file templates included in the boot file MUST be provided as markdown code blocks, with all formatting and content as required by the relevant output files.
- Templates MUST appear at the absolute end of chat-boot.md, in the order listed here, and nowhere else.
- MUST NOT omit, abbreviate, or alter any part of a template.
- MUST NOT provide templates as partials, lists, or plain text—**only as complete markdown code blocks**.

---

## Template Section

### File Header Template

```markdown
<!--
  FILE: [file path/filename]
  PURPOSE: [brief description]
  GENERATED BY: Layer [XXXX] ([layer type/summary])
  LLM MODEL: GPT-4o (2024-06)
-->
````

### logs/PROMPTS.md entry template

## Prompt 00XX: \[Short summary of feature, fix, or refactor]

**Original Prompt:**

\[Paste the user’s original prompt text here.]

**Instruction:**

\[Summarize the interpreted instruction in a single paragraph, as it will be implemented.]

**Result:**

→ See: \[affected files or modules]
→ Commit: 00XX (\[summary of commit, matching commit message])

### docs/LAYER\_INDEX.md entry template

| Layer | Description                                       | Prompt Link                                                | Commit Link                                                                                        |
| ----- | ------------------------------------------------- | ---------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| 00XX  | \[Short description of feature, fix, or refactor] | [logs/PROMPTS.md#prompt-00XX](logs/PROMPTS.md#prompt-00XX) | [\<commit\_hash>](https://github.com/toddm-ClaybookAdvisors/layercake-method/commit/<commit_hash>) |

```

---

**This is the single authoritative chat-boot.md for future layers and threads.**
Let me know if you require this as a file or want to begin a new chat.
```
